set positional-arguments := true
set shell := ["bash", "-eu", "-o", "pipefail", "-c"]
set export := true

# ==================================================
# Color Definitions (Must use double escaped \\033)
# ==================================================

PINK  := "\\033[95m"
CYAN  := "\\033[96m"
BOLD  := "\\033[1m"
RESET := "\\033[0m"

# ==================================================
# AnduinOS System Toolkit
# ==================================================

default:
    @clear
    @printf "\n"
    @printf "\033[1;95m"
    @printf "   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—\n"
    @printf "  â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â•â•\n"
    @printf "  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—\n"
    @printf "  â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â•šâ•â•â•â•â–ˆâ–ˆâ•‘\n"
    @printf "  â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘\n"
    @printf "  â•šâ•â•  â•šâ•â•â•šâ•â•  â•šâ•â•â•â•â•šâ•â•â•â•â•â•  â•šâ•â•â•â•â•â• â•šâ•â•â•šâ•â•  â•šâ•â•â•â• â•šâ•â•â•â•â•â• â•šâ•â•â•â•â•â•â•\n"
    @printf "\033[0m\n"

    @printf "\033[1;96mâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\033[0m\n"
    @printf "\033[1m             ğŸš€ AnduinOS System Toolkit ğŸš€\033[0m\n"
    @printf "\033[2m             Powered by RocketPowerInc\033[0m\n"
    @printf "\033[1;96mâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\033[0m\n\n"

    @printf "\033[1;94mğŸ§° CONVENIENCE\033[0m\n"
    @printf "  refresh-justfile        \033[95mPull latest toolkit\033[0m\n\n"

    @printf "\033[1;94mâš™ SYSTEM\033[0m\n"
    @printf "  update                  \033[92mFull system update (APT + Flatpak)\033[0m\n"
    @printf "  upgrade                 \033[92mFull AnduinOS System Upgrade\033[0m\n"
    @printf "  care                    \033[93mFull system maintenance (APT + Flatpak)\033[0m\n"
    @printf "  factory-reset           \033[91mAuto repair\033[0m\n\n"

    @printf "\033[1;94mğŸ“¦ APT PACKAGES\033[0m\n"
    @printf "  search <pkg>            \033[96mSearch apt packages\033[0m\n"
    @printf "  install <pkg>           \033[92mInstall apt package\033[0m\n"
    @printf "  remove <pkg>            \033[91mRemove apt package\033[0m\n"


    @printf "\033[1;94mğŸ§Š FLATPAK\033[0m\n"
    @printf "  flatpak-search          \033[96mSearch flatpaks\033[0m\n"
    @printf "  flatpak-list            \033[96mList flatpaks\033[0m\n"
    @printf "  flatpak-remotes         \033[96mList remotes\033[0m\n"
    @printf "  flatpak-remove-remote   \033[91mRemove remote <name>\033[0m\n"


    @printf "\033[1;94mğŸ“Š SYSTEM INFO\033[0m\n"
    @printf "  report-disk             \033[93mDisk usage\033[0m\n"
    @printf "  report-memory           \033[93mMemory usage\033[0m\n"
    @printf "  report-cpu              \033[93mCPU info\033[0m\n\n"

    @printf "\033[1;94mğŸŒ EXTERNAL TOOLS\033[0m\n"
    @printf "  tuxmate                 \033[96mOpen TuxMate\033[0m\n"
    @printf "  linux-toys              \033[96mLinux Toys installer\033[0m\n"
    @printf "  linutil                 \033[96mChris Titus LinUtil\033[0m\n"
    @printf "  docker-setup            \033[93mInstall Docker\033[0m\n\n"

    @printf "\033[1;94mğŸ”— WEBSITES\033[0m\n"
    @printf "  packages-site           \033[96mUbuntu packages\033[0m\n"
    @printf "  rocket-dashboard        \033[96mRocket dashboard\033[0m\n\n"

    @printf "\033[1;94mğŸ“ DESKFLOW & CLIPCASCADE\033[0m\n"
    @printf "  install-df              \033[92mInstall ClipCascade\033[0m\n\n"
    @printf "  install-cc              \033[92mInstall ClipCascade\033[0m\n\n"
    @printf "  restart-cc              \033[93mRestart ClipCascade service\033[0m\n"
    @printf "  status-cc               \033[96mCheck ClipCascade status\033[0m\n\n"




# ==================================================
# Convenience
# ==================================================

refresh-justfile:
    TMPDIR=$(mktemp -d) && \
    git clone --depth 1 https://github.com/rocketpowerinc/dotfiles.git "$TMPDIR" && \
    install -m 644 "$TMPDIR/anduinos/justfile" "$HOME/justfile" && \
    rm -rf "$TMPDIR"
    just


# ==================================================
# System
# ==================================================

update:
    sudo apt update && sudo apt upgrade -y
    flatpak update -y
    @echo "System Updated"

upgrade:
    do_anduinos_upgrade

care:
    @printf "\033[1;96mğŸ›  Running Full System Care...\033[0m\n\n"

    @printf "\033[93mğŸ“¦ APT Maintenance...\033[0m\n"
    sudo apt update
    sudo apt upgrade -y
    sudo apt autoremove -y
    sudo apt autoclean
    @printf "\033[92mâœ” APT Complete.\033[0m\n\n"

    @printf "\033[96mğŸ§Š Flatpak Maintenance...\033[0m\n"
    flatpak update -y
    flatpak uninstall --unused -y
    flatpak repair || true
    @printf "\033[92mâœ” Flatpak Complete.\033[0m\n\n"

    @printf "\033[1;95mâœ¨ System Care Finished Successfully!\033[0m\n"

factory-reset:
    do-anduinos-autorepair
    @echo "Factory Reset / Repair Complete"


# ==================================================
# Packages (APT)
# ==================================================

search pkg:
    apt-cache policy {{pkg}}

install pkg:
    sudo apt install -y {{pkg}}

remove pkg:
    sudo apt remove -y {{pkg}}


# ==================================================
# Flatpak
# ==================================================
flatpak-search pkg:
    flatpak search {{pkg}}

flatpak-list:
    flatpak list

flatpak-remotes:
    @printf "\033[96mğŸŒ Listing Flatpak remotes...\033[0m\n"
    flatpak remotes
    @printf "\n\033[92mâœ” Done.\033[0m\n"

flatpak-remove-remote remote:
    @printf "\033[91mğŸ—‘ Removing Flatpak remote: {{remote}}...\033[0m\n"
    flatpak remote-delete {{remote}}
    @printf "\033[92mâœ” Remote removed successfully.\033[0m\n"

# ==================================================
# Info & Diagnostics
# ==================================================

report-disk:
    df -h /

report-memory:
    free -h

report-cpu:
    lscpu


# ==================================================
# External Tools
# ==================================================

tuxmate:
    xdg-open "https://tuxmate.com/" >/dev/null 2>&1 &

linux-toys:
    x-terminal-emulator -e bash -c 'curl -fsSL https://linux.toys/install.sh | bash'

linutil:
    x-terminal-emulator -e bash -c 'curl -fsSL https://christitus.com/linux | sh'

docker-setup:
    curl -fsSL https://get.docker.com | sh
    sudo usermod -aG docker $USER
    @echo "Docker Installed. Log out and back in to use docker without sudo."


# ==================================================
# Websites
# ==================================================

packages-site:
    xdg-open https://packages.ubuntu.com/ >/dev/null 2>&1 &

rocket-dashboard:
    xdg-open https://rocketdashboard.notion.site/Welcome-to-RocketPowerInc-1a1627bc6fd8805ab693f164a1b3ceda >/dev/null 2>&1 &


# ==================================================
# Deskflow and ClipCascade
# ==================================================

install-df:
    @printf "\033[96mğŸ§Š Installing Deskflow (Flatpak)...\033[0m\n"
    flatpak install -y flathub org.deskflow.deskflow

    @printf "\033[93mâš™ Installing GNOME Tweaks for Start at boot option...\033[0m\n"
    sudo apt update
    sudo apt install -y gnome-tweaks

    @printf "\033[92mâœ” Deskflow and GNOME Tweaks installed successfully.\033[0m\n"

install-cc:
    TMPDIR=$(mktemp -d) && \
    git clone --depth 1 https://github.com/rocketpowerinc/dotfiles.git "$TMPDIR" && \
    chmod +x "$TMPDIR/nixos/clipcascade-install.sh" && \
    bash "$TMPDIR/nixos/clipcascade-install.sh" && \
    rm -rf "$TMPDIR"

restart-cc:
    @printf "\033[93mğŸ”„ Restarting ClipCascade...\033[0m\n"
    systemctl --user restart clipcascade
    @printf "\033[92mâœ” ClipCascade restarted.\033[0m\n"
    @printf "\033[96mâ„¹ Check status:\033[0m systemctl --user status clipcascade\n"
    systemctl --user status clipcascade

status-cc:
    systemctl --user status clipcascade